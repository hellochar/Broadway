<!DOCTYPE html>

<html>
<head>
    <title>Broadway controller</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="http://static.firebase.com/v0/firebase.js"></script>
    <script type="text/javascript">
        
        function attributes(attr) {
            var str = "";
            for(key in attr) {
                str += key+"="+attr[key]+" "
            }
            return str;
        }
        

        function audio(url, attr) {
            attr = attr || {autoplay: true};
            return "<audio "+attributes(attr)+">" +
                "<source src='"+url+"' />" + 
                "</audio>"
        }
        
        function video(url, attr) {
            attr = attr || {autoplay: true};
            return "<video "+attributes(attr)+">" +
                "<source src='"+url+"' />" +
                "</video>"
        }
        
        function iframe(url, attr) {
            attr = attr || {};
            return "<iframe src='"+url+"'/>";
        }
        

        function page(url) {
            $.get('pages/'+url+'.html', function(response) {
                dataRef.set(response);
            });
        }


        var index = -1;
        var dataRef = new Firebase('http://gamma.firebase.com/broadway/');
        fragments = []
        
        fragments.push()
        fragments.push('<iframe src="http://player.vimeo.com/video/7458473?autoplay=1" width="853" height="480" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>')
        fragments = fragments.concat("Presentations are boring. Broadway is not!".split(" "))
        fragments.push(audio("http://noproblo.dayjo.org/ZeldaSounds/LOZ/LOZ_Shield.wav") + "Beep.");
        
        function reset() {
            index = -1;
            dataRef.set(null);
        }
        
        function setFragment(idx) {
            index = idx;
            if(index < fragments.length) {
                frag = fragments[index];
                dataRef.set(frag);
            } else {
                dataRef.set("Curtains drop.");
            }
        }
        
        $(document).ready(function() {
            $(document).keyup(function (event) {
                console.log(event);
                if( event.which == 32) {//space
                    nextFragment();
                }
            });
            reset();
        });
    </script>
    <style type="text/css">
        body {
            background: #c8c8c8;
            font-family: Georgia;
        }
        p {
            background: #fff;
            width: 50%;
            border-radius: 5pt;
            border: 2px solid gray;
            text-align: center;
            float: left;
        }
        #iframe {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<p>
<iframe id="iframe" src="broadway.html"></iframe>
</p>

<p>
    <button onclick="reset()">Reset</button>
</p>

<p>
Enter a url to iframe: <input type='text' id='urlInput' placeholder='Enter a url...'>
    <script type="text/javascript">
        $('#urlInput').keypress(function (e) {
            url = $('#urlInput')[0].value;
            if(e.which == 13) {
                dataRef.set(iframe(url));
            }
        });
    </script>
</p>

<p>
    <input type='text' id='pagesInput' placeholder='Enter a page...'>
    <script type="text/javascript">
        $('#pagesInput').keypress(function (e) {
            url = $('#pagesInput')[0].value;
            if(e.which == 13) {
                page(url);
            }
        });
    </script>
</p>

</body>
</html>
